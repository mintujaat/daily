<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daily Tasks ‚Äî Light Mode</title>
  <style>
    :root {
      --bg: #f5f8ff;
      --card: #ffffffcc;
      --muted: #6b7280;
      --accent: #2563eb;
      --accent-hover: #1e40af;
      --ok: #16a34a;
      --danger: #dc2626;
      --radius: 12px;
      --shadow: 0 10px 30px rgba(0,0,0,0.08);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: url('https://i.pinimg.com/originals/e3/fc/a0/e3fca0e0f23bfa16ba60388bc5097920.jpg') no-repeat center center fixed;
      background-size: cover;
      backdrop-filter: blur(0px);
      color: #111827;
      display: flex;
      justify-content: center;
      padding: 24px;
      min-height: 100vh;
      transition: background .5s ease;
    }
    .app {
      width: 100%;
      max-width: 960px;
      opacity: 0;
      transform: translateY(10px);
      transition: all .6s cubic-bezier(.2,.9,.3,1);
    }
    .app.loaded {opacity: 1; transform: translateY(0);}
    header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 16px;
    }
    .brand {display: flex; align-items: center; gap: 10px;}
    h1 {font-size: 22px; color: #111827;}
    .small {color: var(--muted); font-size: 14px;}
    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      margin-bottom: 16px;
      backdrop-filter: blur(10px);
      animation: fadeIn .6s ease;
    }
    @keyframes fadeIn {from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    input, button {
      border-radius: var(--radius);
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      font-size: 15px;
    }
    input:focus {outline: 2px solid var(--accent);}
    button {
      background: var(--accent);
      color: white;
      cursor: pointer;
      transition: background .2s;
    }
    button:hover {background: var(--accent-hover);}
    .grid {display: grid; grid-template-columns: 1fr 320px; gap: 14px;}
    @media(max-width:768px){.grid{grid-template-columns:1fr}}
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }
    th {color: var(--muted); font-size: 14px;}
    td .task-title {font-weight: 600; margin-bottom: 2px;}
    td .task-notes {font-size: 13px; color: var(--muted);}
    .btn {
      border: none;
      padding: 8px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    .btn.edit {background: #f3f4f6;}
    .btn.delete {background: #fee2e2; color: var(--danger);}
    .btn.complete {background: #dcfce7; color: var(--ok);}
    .days-left.due {color: var(--danger); font-weight: bold;}
    .days-left.soon {color: #ca8a04;}
    .modal-backdrop {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.3);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none;
      transition: opacity .2s;
      z-index: 50;
    }
    .modal-backdrop.show {opacity: 1; pointer-events: auto;}
    .modal {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      width: 90%;
      max-width: 360px;
    }
    .modal h3 {margin-bottom: 10px;}
    .modal .row {display: flex; gap: 8px; justify-content: flex-end;}
    .modal button {padding: 8px 12px;}
    .modal .danger {background: var(--danger); color: #fff;}
    .modal .cancel {background: #f3f4f6;}
    /* Loader */
    #loader {
      position: fixed; inset: 0;
      background: rgba(255,255,255,0.9);
      display: flex; align-items: center; justify-content: center;
      z-index: 100;
    }
    .spinner {
      width: 48px; height: 48px;
      border: 5px solid #e5e7eb;
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div id="loader"><div class="spinner"></div></div>

  <div class="app" id="app">
    <header>
      <div class="brand">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
          <path d="M9 12h6M12 5v14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
        <div>
          <h1>Daily Tasks</h1>
          <div id="motivation" class="small">Loading...</div>
        </div>
      </div>
      <div id="authArea" class="card small"></div>
    </header>

    <main class="grid">
      <section class="card">
        <form id="taskForm" autocomplete="off">
          <input id="title" type="text" placeholder="Task title" required>
          <input id="endDate" type="date">
          <input id="notes" type="text" placeholder="Notes (optional)">
          <button type="submit">Add Task</button>
        </form>

        <table>
          <thead>
            <tr><th>Task</th><th>End</th><th>Days Left</th><th>Status</th><th>Actions</th></tr>
          </thead>
          <tbody id="tasksBody">
            <tr><td colspan="5" class="small">Sign in to see tasks.</td></tr>
          </tbody>
        </table>
      </section>

      <aside class="card">
        <h3>Summary</h3>
        <div id="summary" class="small">Sign in to see your tasks.</div>
        <hr style="margin:10px 0;">
        <h4>Today</h4>
        <div id="todayList" class="small">‚Äî</div>
      </aside>
    </main>
  </div>

  <!-- Modal -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <h3 id="modalTitle">Confirm</h3>
      <p id="modalMessage">Are you sure?</p>
      <div class="row">
        <button id="modalCancel" class="cancel">Cancel</button>
        <button id="modalConfirm" class="danger">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Firebase Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
    import { getFirestore, collection, doc, addDoc, onSnapshot, query, orderBy, updateDoc, deleteDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD7CbGgq25umkTqZ45rAFC4u6bk-rvpK1A",
      authDomain: "tasks-21297.firebaseapp.com",
      projectId: "tasks-21297",
      storageBucket: "tasks-21297.firebasestorage.app",
      messagingSenderId: "60031752605",
      appId: "1:60031752605:web:b0965956fef8084ea4b774",
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loader = document.getElementById("loader");
    const appEl = document.getElementById("app");

    setTimeout(() => {
      loader.style.display = "none";
      appEl.classList.add("loaded");
    }, 1200);

    const uidToday = () => new Date().toISOString().split("T")[0];
    const daysLeft = (endDate) => {
      if (!endDate) return "‚Äî";
      const diff = Math.ceil((new Date(endDate) - new Date()) / 86400000);
      if (diff < 0) return "Expired";
      if (diff === 0) return "Due today";
      return diff + " day" + (diff > 1 ? "s" : "");
    };

    const tasksBody = document.getElementById("tasksBody");
    const summary = document.getElementById("summary");
    const todayList = document.getElementById("todayList");
    const motivationEl = document.getElementById("motivation");
    const authArea = document.getElementById("authArea");
    const taskForm = document.getElementById("taskForm");
    const titleInput = document.getElementById("title");
    const endInput = document.getElementById("endDate");
    const notesInput = document.getElementById("notes");

    const modalBackdrop = document.getElementById("modalBackdrop");
    const modalTitle = document.getElementById("modalTitle");
    const modalMessage = document.getElementById("modalMessage");
    const modalConfirm = document.getElementById("modalConfirm");
    const modalCancel = document.getElementById("modalCancel");

    let modalResolve;
    function showModal(title, msg, confirmText="Confirm", cancelText="Cancel"){
      modalTitle.textContent = title;
      modalMessage.textContent = msg;
      modalConfirm.textContent = confirmText;
      modalCancel.textContent = cancelText;
      modalBackdrop.classList.add("show");
      return new Promise(res => modalResolve = res);
    }
    function hideModal(ok=false){
      modalBackdrop.classList.remove("show");
      if (modalResolve) modalResolve(ok);
    }
    modalConfirm.onclick = ()=> hideModal(true);
    modalCancel.onclick = ()=> hideModal(false);
    modalBackdrop.onclick = e => { if(e.target===modalBackdrop) hideModal(false); };

    let unsubscribe = null, currentUid = null;
    function userTasks(uid){ return collection(db, "users", uid, "tasks"); }

    function renderTasks(tasks){
      tasksBody.innerHTML = "";
      if (!tasks.length){
        tasksBody.innerHTML = `<tr><td colspan="5" class="small">No tasks yet.</td></tr>`;
        summary.textContent = "No tasks.";
        return;
      }
      const today = uidToday();
      let total=0, done=0, active=0;
      for (const t of tasks){
        total++;
        const isDone = t.lastCompletedDate === today;
        if (isDone) done++; else active++;
        const days = daysLeft(t.endDate);
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><div class="task-title">${t.title}</div><div class="task-notes">${t.notes||""}</div></td>
          <td>${t.endDate||"‚Äî"}</td>
          <td class="days-left ${days.includes("Due")?"due":days.includes("day")&&parseInt(days)?parseInt(days)<=3?"soon":"" :""}">${days}</td>
          <td>${isDone?"‚úÖ Done":"‚è≥ Incomplete"}</td>
          <td>
            <button class="btn complete">${isDone?"‚ü≤":"‚úî"}</button>
            <button class="btn edit">‚úèÔ∏è</button>
            <button class="btn delete">üóë</button>
          </td>`;
        row.querySelector(".complete").onclick = async()=>{
          const confirm = await showModal("Mark Complete", `Mark "${t.title}" ${isDone?"incomplete":"complete"}?`);
          if(!confirm) return;
          await updateDoc(doc(db,"users",currentUid,"tasks",t.id), {lastCompletedDate: isDone?"":today});
        };
        row.querySelector(".delete").onclick = async()=>{
          const confirm = await showModal("Delete Task", `Delete "${t.title}" permanently?`);
          if(!confirm) return;
          await deleteDoc(doc(db,"users",currentUid,"tasks",t.id));
        };
        row.querySelector(".edit").onclick = async()=>{
          const newTitle = prompt("Edit title", t.title);
          if (newTitle!==null) await updateDoc(doc(db,"users",currentUid,"tasks",t.id), {title:newTitle});
        };
        tasksBody.appendChild(row);
      }
      summary.textContent = `${done} done today ‚Ä¢ ${active} incomplete ‚Ä¢ ${total} total`;
      todayList.textContent = tasks.filter(t=>t.lastCompletedDate===today).map(t=>t.title).join(", ") || "‚Äî";
    }

    function attach(uid){
      currentUid = uid;
      const q = query(userTasks(uid), orderBy("createdAt","desc"));
      unsubscribe && unsubscribe();
      unsubscribe = onSnapshot(q, snap=>{
        renderTasks(snap.docs.map(d=>({id:d.id,...d.data()})));
      });
    }

    onAuthStateChanged(auth, user=>{
      if(user){
        authArea.innerHTML = `<div class="small">Signed in as ${user.email}</div><button id="logout">Logout</button>`;
        document.getElementById("logout").onclick = ()=> signOut(auth);
        attach(user.uid);
      }else{
        authArea.innerHTML = `
          <input id="email" placeholder="Email">
          <input id="pass" type="password" placeholder="Password">
          <div style="display:flex;gap:8px;margin-top:6px">
            <button id="signup">Sign up</button>
            <button id="login" style="background:#f3f4f6;color:#111">Login</button>
          </div>`;
        document.getElementById("signup").onclick = ()=> createUserWithEmailAndPassword(auth,email.value,pass.value).catch(e=>alert(e.message));
        document.getElementById("login").onclick = ()=> signInWithEmailAndPassword(auth,email.value,pass.value).catch(e=>alert(e.message));
        tasksBody.innerHTML = `<tr><td colspan="5" class="small">Sign in to see tasks.</td></tr>`;
      }
    });

    taskForm.onsubmit = async e=>{
      e.preventDefault();
      if(!auth.currentUser) return alert("Sign in first");
      await addDoc(userTasks(auth.currentUser.uid), {
        title: titleInput.value.trim(),
        notes: notesInput.value.trim(),
        endDate: endInput.value,
        createdAt: serverTimestamp(),
        lastCompletedDate: ""
      });
      titleInput.value = notesInput.value = endInput.value = "";
    };

    const hr = new Date().getHours();
    motivationEl.textContent = hr<12?"Rise and focus.":"Stay consistent.";
  </script>
</body>
</html>
